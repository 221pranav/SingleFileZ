!function(){"use strict";const n=globalThis.document;if(n instanceof globalThis.Document){const t=n.createElement("script");t.src="data:,("+function(){"undefined"==typeof globalThis&&(window.globalThis=window);const n=globalThis.document,t=(n,t,e)=>globalThis.addEventListener(n,t,e),e=n=>globalThis.dispatchEvent(n),a=globalThis.CustomEvent,r=globalThis.FileReader,i=globalThis.Blob,o="single-filez-new-font-face",c="single-filez-delete-font",s="single-filez-clear-fonts",u="single-file-response-get-adopted-stylesheets",f={family:"font-family",style:"font-style",weight:"font-weight",stretch:"font-stretch",unicodeRange:"unicode-range",variant:"font-variant",featureSettings:"font-feature-settings"};if(t("single-file-request-get-adopted-stylesheets",(n=>{const t=n.target.shadowRoot;if(t){const e=Array.from(t.adoptedStyleSheets).map((n=>Array.from(n.cssRules).map((n=>n.cssText)).join("\n")));e.length&&n.target.dispatchEvent(new a(u,{detail:{adoptedStyleSheets:e}}))}}),{capture:!0}),globalThis.FontFace){const t=globalThis.FontFace;globalThis.FontFace=function(){return w(...arguments).then((n=>e(new a(o,{detail:n})))),new t(...arguments)},globalThis.FontFace.prototype=t.prototype,globalThis.FontFace.toString=function(){return"function FontFace() { [native code] }"};const r=n.fonts.delete;n.fonts.delete=function(t){return w(t.family).then((n=>e(new a(c,{detail:n})))),r.call(n.fonts,t)},n.fonts.delete.toString=function(){return"function delete() { [native code] }"};const i=n.fonts.clear;n.fonts.clear=function(){return e(new a(s)),i.call(n.fonts)},n.fonts.clear.toString=function(){return"function clear() { [native code] }"}}async function w(n,t,e){const a={};return a["font-family"]=n,a.src=t,e&&Object.keys(e).forEach((n=>{f[n]&&(a[f[n]]=e[n])})),new Promise((n=>{if(a.src instanceof ArrayBuffer){const t=new r;t.readAsDataURL(new i([a.src])),t.addEventListener("load",(()=>{a.src="url("+t.result+")",n(a)}))}else n(a)}))}}.toString()+")()",(n.documentElement||n).appendChild(t),t.remove()}const t=globalThis.browser,e=globalThis.document;if(e instanceof globalThis.Document&&t&&t.runtime&&t.runtime.getURL){const n=e.createElement("script");n.src=t.runtime.getURL("/lib/single-file-hooks-frames.js"),n.async=!1,(e.documentElement||e).appendChild(n),n.remove()}const a=0,r=[a],i=Symbol(),o=new TextEncoder,c=new TextDecoder,s=new Array(256);let u=0;function f(n,t,e,a){if(void 0===a){if(u++,!(s.length-u>=r.length))throw new Error("Reached maximum number of custom types");s[s.length-u]={serialize:n,parse:t,test:e}}else s[a]={serialize:n,parse:t,test:e}}async function w(n,t){const e=s.findIndex((({test:e}={})=>e&&e(t,n)));n.addObject(t),await n.append(new Uint8Array([e]));const r=s[e].serialize;r&&await r(n,t),e!=a&&T(t)&&(await async function(n,t){const e=Object.getOwnPropertySymbols(t),a=e.map((n=>[n,t[n]]));await l(n,a)}(n,t),await async function(n,t){let e=Object.entries(t);j(t)&&(e=e.filter((([n])=>!O(Number(n)))));await w(n,e.length);for(const[t,a]of e)await y(n,t),await w(n,a)}(n,t))}async function l(n,t){await w(n,t.length);const e=Object.keys(t).filter((n=>O(Number(n)))).map((n=>Number(n)));let a=0,r=e[a];for(const[o,c]of t.entries())r==o?(r=e[++a],await w(n,c)):await w(n,i)}async function y(n,t){const e=o.encode(t);await w(n,e.length),await n.append(e)}async function d(n,t){await w(n,t.length),await n.append(new Uint8Array(t.buffer))}async function b(n,t){const e=new Uint8Array(new Float64Array([t]).buffer);await n.append(e)}async function m(n,t){const e=new Uint8Array([Number(t)]);await n.append(e)}f((async function(n,t){const e=n.objects.indexOf(t);await w(n,e)}),(async function(n){const t=await h(n);return new g(t,n)}),(function(n,t){return T(n)&&t.objects.includes(n)}),a),f(null,(function(){return{}}),T),f(l,p,j),f(y,A,(function(n){return"string"==typeof n})),f(d,(async function(n){const t=await h(n),e=await n.consume(8*t);return new Float64Array(e.buffer)}),(function(n){return n instanceof Float64Array})),f(d,(async function(n){const t=await h(n),e=await n.consume(4*t);return new Float32Array(e.buffer)}),(function(n){return n instanceof Float32Array})),f(d,(async function(n){const t=await h(n),e=await n.consume(4*t);return new Uint32Array(e.buffer)}),(function(n){return n instanceof Uint32Array})),f(d,(async function(n){const t=await h(n),e=await n.consume(4*t);return new Int32Array(e.buffer)}),(function(n){return n instanceof Int32Array})),f(d,(async function(n){const t=await h(n),e=await n.consume(2*t);return new Uint16Array(e.buffer)}),(function(n){return n instanceof Uint16Array})),f(d,(async function(n){const t=await h(n),e=await n.consume(2*t);return new Int16Array(e.buffer)}),(function(n){return n instanceof Int16Array})),f(d,(async function(n){const t=await h(n),e=await n.consume(t);return new Uint8ClampedArray(e.buffer)}),(function(n){return n instanceof Uint8ClampedArray})),f(d,(async function(n){const t=await h(n);return await n.consume(t)}),(function(n){return n instanceof Uint8Array})),f(d,(async function(n){const t=await h(n),e=await n.consume(t);return new Int8Array(e.buffer)}),(function(n){return n instanceof Int8Array})),f((async function(n,t){await w(n,t.byteLength),await n.append(new Uint8Array(t))}),(async function(n){const t=await h(n);return(await n.consume(t)).buffer}),(function(n){return n instanceof ArrayBuffer})),f(b,U,I),f((async function(n,t){const e=new Uint8Array(new Uint32Array([t]).buffer);await n.append(e)}),(async function(n){const t=await n.consume(4);return new Uint32Array(t.buffer)[0]}),(function(n){return O(n)&&n>=0&&n<=4294967295})),f((async function(n,t){const e=new Uint8Array(new Int32Array([t]).buffer);await n.append(e)}),(async function(n){const t=await n.consume(4);return new Int32Array(t.buffer)[0]}),(function(n){return O(n)&&n>=-2147483648&&n<=2147483647})),f((async function(n,t){const e=new Uint8Array(new Uint16Array([t]).buffer);await n.append(e)}),(async function(n){const t=await n.consume(2);return new Uint16Array(t.buffer)[0]}),(function(n){return O(n)&&n>=0&&n<=65535})),f((async function(n,t){const e=new Uint8Array(new Int16Array([t]).buffer);await n.append(e)}),(async function(n){const t=await n.consume(2);return new Int16Array(t.buffer)[0]}),(function(n){return O(n)&&n>=-32768&&n<=32767})),f((async function(n,t){const e=new Uint8Array([t]);await n.append(e)}),(async function(n){const t=await n.consume(1);return new Uint8Array(t.buffer)[0]}),(function(n){return O(n)&&n>=0&&n<=255})),f((async function(n,t){const e=new Uint8Array(new Int8Array([t]).buffer);await n.append(e)}),(async function(n){const t=await n.consume(1);return new Int8Array(t.buffer)[0]}),(function(n){return O(n)&&n>=-128&&n<=127})),f(null,(function(){return}),(function(n){return void 0===n})),f(null,(function(){return null}),(function(n){return null===n})),f(null,(function(){return NaN}),(function(n){return Number.isNaN(n)})),f(m,v,(function(n){return"boolean"==typeof n})),f((async function(n,t){await y(n,t.description)}),(async function(n){const t=await A(n);return Symbol(t)}),(function(n){return"symbol"==typeof n})),f(null,(function(){return i}),F),f((async function(n,t){const e=t.entries();await w(n,t.size);for(const[t,a]of e)await w(n,t),await w(n,a)}),(async function(n){const t=await h(n),e=new Map;t&&await async function a(r=0){const i=await h(n),o=await h(n);n.setObject([i,o],((n,t)=>e.set(n,t))),r<t-1&&await a(r+1)}();return e}),(function(n){return n instanceof Map})),f((async function(n,t){await w(n,t.size);for(const e of t)await w(n,e)}),(async function(n){const t=await h(n),e=new Set;t&&await async function a(r=0){const i=await h(n);n.setObject([i],(n=>e.add(n))),r<t-1&&await a(r+1)}();return e}),(function(n){return n instanceof Set})),f((async function(n,t){await b(n,t.getTime())}),(async function(n){const t=await U(n);return new Date(t)}),(function(n){return n instanceof Date})),f((async function(n,t){await y(n,t.message),await y(n,t.stack)}),(async function(n){const t=await A(n),e=await A(n),a=new Error(t);return a.stack=e,a}),(function(n){return n instanceof Error})),f((async function(n,t){await y(n,t.source),await y(n,t.flags)}),(async function(n){const t=await A(n),e=await A(n);return new RegExp(t,e)}),(function(n){return n instanceof RegExp})),f((async function(n,t){await y(n,t.valueOf())}),(async function(n){return new String(await A(n))}),(function(n){return n instanceof String})),f((async function(n,t){await b(n,t.valueOf())}),(async function(n){return new Number(await U(n))}),(function(n){return n instanceof Number})),f((async function(n,t){await m(n,t.valueOf())}),(async function(n){return new Boolean(await v(n))}),(function(n){return n instanceof Boolean}));class g{constructor(n,t){this.index=n,this.data=t}getObject(){return this.data.objects[this.index]}}async function h(n){const t=(await n.consume(1))[0],e=s[t].parse,r=n.getObjectId(),i=await e(n);return t!=a&&T(i)&&(await async function(n,t){const e=await p(n);n.setObject([e],(n=>n.forEach((([n,e])=>t[n]=e))))}(n,i),await async function(n,t){const e=await h(n);e&&await a();async function a(r=0){const i=await A(n),o=await h(n);n.setObject([o],(n=>t[i]=n)),r<e-1&&await a(r+1)}}(n,i)),n.resolveObject(r,i),i}async function p(n){const t=await h(n),e=new Array(t);return t&&await async function a(r=0){const i=await h(n);F(i)||n.setObject([i],(n=>e[r]=n));r<t-1&&await a(r+1)}(),e}async function A(n){const t=await h(n),e=await n.consume(t);return c.decode(e)}async function U(n){const t=await n.consume(8);return new Float64Array(t.buffer)[0]}async function v(n){const t=await n.consume(1);return Boolean(t[0])}function T(n){return n===Object(n)}function j(n){return"number"==typeof n.length}function F(n){return n===i}function I(n){return"number"==typeof n}function O(n){return I(n)&&Number.isInteger(n)}let E=new Map;browser.runtime.onMessage.addListener((n=>"singlefile.fetchFrame"==n.method&&window.frameId&&window.frameId==n.frameId?async function(n){try{const a=await(t=n.url,e={cache:"force-cache",headers:n.headers},window.fetch(t,e));return{status:a.status,headers:[...a.headers],array:Array.from(new Uint8Array(await a.arrayBuffer()))}}catch(n){return{error:n&&n.toString()}}var t,e}(n):"singlefile.fetchResponse"==n.method?async function(n){let t=E.get(n.requestId);if(t){const e=await t.parser.next(n.data);if(e.done){E.delete(n.requestId);const a=e.value;a.error?t.reject(new Error(a.error)):t.resolve({status:a.status,headers:{get:n=>a.headers&&a.headers[n]},arrayBuffer:async()=>a.array.buffer})}}return{}}(n):void 0))}();
